#summary UrukDroid DVB service.

<wiki:toc max_depth="2" />

= Introduction =

DVB service for Uruk Droid should make a bit easier initializing your USB DVB-T dongle with Archos devices. Only few devices are already tested to work, so if you please try it with different hardware - let us know.

This manual is for UrukDroid 1.0+ only (older release did it in a different way).

You will also require some application to stream data from DVB to mediasystem. This kind of application is LiveTV made by chrulri. You can download it from [http://code.google.com/p/archos-gen8-dvb/downloads/list project page].

= DVB devices that are known to work =

 * [http://www.linuxtv.org/wiki/index.php/Hauppauge_WinTV-HVR-950Q WinTV-HVR-950Q] xc5000 chipset
 * [http://www.linuxtv.org/wiki/index.php/E3C_EC168 EzTV DUTV009 USB DVB-T Receiver] EC168 chipset
 * DiBcom DiB0700 USB DVB devices dib0700 chipset

= How to use DVB service =

If your device is on above list - you need only to uncomment proper line in configuration (/etc/uruk.conf/dvb) file.
{{{
# Part of Uruk-Droid Android configuration system
#
# ver. 1.2 (26.04.2011) Adrian (Sauron) Siemieniak
#

# 1 to enable this service
# 0 to disable this service
service_enabled=0

# Where to store device information
dvb_devices_conf="/etc/uruk.conf/dvb-devices"

# DVB card type
# Working USB DVB devices
# 1. (dvb-usb-af9005) Afatech AF9005 DVB-T USB1.1 support
# 2. (dvb-usb-dib0700) DiBcom DiB0700 USB DVB devices (see help for supported devices)
#dvb_driver='dvb-usb-dib0700'
# 3. (dvb-usb-af9015) Afatech AF9015 DVB-T USB2.0 support
# 4. (dvb-usb-cinergyT2) Terratec CinergyT2/qanu USB 2.0 DVB-T receiver
# 5. (smsusb) Siano SMS1XXX USB dongle support
# 6. (dvb-usb-ec168) EC168 USB dongle support
#dvb_driver='dvb-usb-ec168'
# 7. (xc5000) WinTV-HVR-950Q dongle support
dvb_driver="xc5000"
}}}
And restart DVB service with USB DVB device connected to Archos. Above  you can see an example for Haupage 950Q DVB device.

To is if device is configured properly you can use command like:
{{{
root@urukdroid:/root# cd /etc/uruk.d/
root@urukdroid:/etc/uruk.d# ./dvb devstatus
Uruk-DVB: device configured
}}}
If you will see message "device not found" you may wan to try "./dvb fixdev" command. This will try to generate proper configuration file for your device.

= How does DVB service works =

This knowledge may be required to run your device.

First of all, like every other device DVB-T dongles requires driver and probably firmware. Driver is a Linux kernel part shipped with UrukDroid. There is quite a big bunch of those drivers - but they need to be tested and configured properly.
{{{
root@urukdroid:/etc/uruk.d# cd /lib/modules/2.6.29-omap1/kernel/drivers/media/dvb/dvb-usb/
root@urukdroid:/lib/modules/2.6.29-omap1/kernel/drivers/media/dvb/dvb-usb# ls
dvb-usb-a800.ko           dvb-usb-au6610.ko     dvb-usb-dib0700.ko        dvb-usb-dtt200u.ko  dvb-usb-gl861.ko        dvb-usb-ttusb2.ko
dvb-usb-af9005-remote.ko  dvb-usb-az6027.ko     dvb-usb-dibusb-common.ko  dvb-usb-dtv5100.ko  dvb-usb-gp8psk.ko       dvb-usb-umt-010.ko
dvb-usb-af9005.ko         dvb-usb-ce6230.ko     dvb-usb-dibusb-mb.ko      dvb-usb-dw2102.ko   dvb-usb-m920x.ko        dvb-usb-vp702x.ko
dvb-usb-af9015.ko         dvb-usb-cinergyT2.ko  dvb-usb-dibusb-mc.ko      dvb-usb-ec168.ko    dvb-usb-nova-t-usb2.ko  dvb-usb-vp7045.ko
dvb-usb-anysee.ko         dvb-usb-cxusb.ko      dvb-usb-digitv.ko         dvb-usb-friio.ko    dvb-usb-opera.ko        dvb-usb.ko
}}}

Some of this drivers requires proper firmware
{{{
root@urukdroid:/root# ls /lib/firmware/
TIInit_7.2.31.bts  af9005.fw  dvb-fe-xc5000-1.6.114.fw  dvb-usb-af9015.fw  dvb-usb-dib0700-1.20.fw  dvb-usb-ec168.fw
}}}
If it's not there already - you have to find it on net (and if working - report back to us).

When DVB service is started:
 * it loads some default, required modules and modules configured in _/etc/uruk.conf/dvb_
 * if device is present, and driver will report back it existence by creating _/dev/dvb0.`*`_ devices,
 * service will create/update dvb configuration file in _/etc/uruk.conf/dvb-devices_.

This is how it should work and since now you should be able to use your dvb freely.

Sometimes devices like WinTV-HVR-950Q don't want to configure properly while plugged in (modules are reporting errors). You will need to load service first and then connect USB. But in this case we will miss some required information to create _/etc/uruk.conf/dvb-devices_ - that's why there is "./dvb fixdev"

== More detailed steps ==

 * ./dvb start (or during system start)
 * dvb checks if it's not already started and loads dvb core and usb modules
 * dvb loads modules from /etc/uruk.conf/dvb file
  * before loading modules "modprobe" will check for module dependencies and try to load some required modules before - you can see it in /etc/modprobe.d/dvb.conf
 * dvb will check if /dev/dvb0.`*` devices are present (driver reported working dvb device)
  * if device is present, dvb will try to update _/etc/uruk.conf/dvb-devices_ with proper node values and create devices in /dev/dvb/
  * if device is NOT present, dvb will try to create devices like configured in _/etc/uruk.conf/dvb-devices_ in /dev/dvb/

== What for is _/etc/uruk.conf/dvb-devices_ file? ==

DVB driver creates proper device in /dev/dvb0.`*`. LiveTV application requires devices to be created in /dev/dvb/frontend0/`*`.  So we need to create those devices in different place (this stuff is usually made with mknod tool). We could do a simple symlink (ln -s /dev/dvb0.demux /dev/dvb/frontend0/dvb.demux) but this will not solve one more problem - file access permissions. Devices to be readable/writeable by Android apps requires (long story short) 0777 permission.

So in this file we have stored information how to recreate device in /dev/dvb/frontend0/ directory, even when our DVB device is not plugged in (so we can start Archos, later plug DVB device and it should work instantly).

= DVB Service special options =
DVB service has two special options, to help you configure it properly.

 * ./dvb devstatus - this will show you if your device IS or ISN'T visible to system. Even if this option shows that device is configured, you may need still use "fixdev" to make it work with LiveTV app.
 * ./dvb fixdev - this option fill force creating dvb configuration file _/etc/uruk.conf/dvb-devices_. This file is updated automatically on every dvb service start, but with some devices it may not work. This option should be required to be called just once - later dvb service will use already created dvb configuration.

= Configuration file =

*Location:* /etc/uruk.conf/dvb

*Configuration options:* 
 * dvb_devices_conf - file name, where DVB service should store information about DVB devices. _Default: "/etc/uruk.conf/dvb-devices"_
 * dvb_driver - name of DVB driver that suits your DVB usb dongle. Please choose one from listen in configuration file, or add new. _Default: none_


= Example =

Here is small example of working DVBT with Uruk Droid 0.7 and LiveDVB app.
<wiki:video url="http://www.youtube.com/watch?v=sJjoiP4fAt4"/>